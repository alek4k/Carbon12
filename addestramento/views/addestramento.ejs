<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8">
    <meta author="Carbon12">
    <title>Pagina di addestramento</title>
    <link href="/css/style.css" rel="stylesheet" type="text/css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>
<body>
<img src="/images/C.png" alt=""/>
<h1>Predire in Grafana</h1>
<h2>Pagina di addestramento</h2>
<p>In questa pagina Ã¨ possibile addestrare il modello di predizione
    per ottenere il predittore da inserire nel plug-in</p>
<form action="fileupload" method="post" enctype="multipart/form-data">
    <fieldset>
        <% if (error == 'Struttura csv non valida') { %>
            <p class='error'>Struttura file csv non valida: la prima colonna deve avere etichetta <b>Time</b>,
                l'ultima etichetta <b>Labels</b></p>
        <%} else { %>
            <p class='error'><%= error %></p>
        <%}%>
        <label for="trainFile">Seleziona il file coi dati di addestramento (formato CSV):</label>
        <input type="file"  id="trainFile" value="upload file" accept=".csv" name="trainFile" required>
        <label for="configFile">Seleziona il file con la configurazione del modello (formato JSON):</label>
        <input type="file" id="configFile" value="upload file" accept=".json" name="configFile">
        <label for="modelType">Seleziona il modello da addestrare:</label>
        <select name="modello" id="modelType">
            <option selected value="SVM">SVM</option>
            <option value="RL">RL</option>
        </select>
        <label for="note">Inserisci delle note per il predittore</label>
        <textarea id="note" rows="4" cols="50" placeholder="le tue note..." name="note" required></textarea>
        <label for="nomeFile">Inserisci il nome del file Predittore</label>
        <input type="text" id="nomeFile" name="nomeFile" placeholder="predittore">
        <input type="submit" id="submit" value="AVVIO ADDESTRAMENTO">
    </fieldset>
</form>
<div id="mychart">
    <canvas id="chart" width="50px" height="50px"></canvas>
</div>

<script>
    $(document).ready(function(){
        $(document).on('change', '#trainFile', function(){
            var name = document.getElementById("trainFile").files[0].name;
            var form_data = new FormData();
            var ext = name.split('.').pop().toLowerCase();
            if(jQuery.inArray(ext, ['csv']) !== -1)
            {
                form_data.append('trainFile', document.getElementById('trainFile').files[0]);
                $.ajax({
                    url:"/loadCsv",
                    method:"POST",
                    data: form_data,
                    contentType: false,
                    cache: false,
                    processData: false,
                    success:function(response)
                    {
                        const result = JSON.parse(response);
                        let buildData = [];
                        for (var i = 0; i < result.length; i++) {
                            buildData.push({x: result[i][0], y: result[i][1]});
                        }

                        const ctx = document.getElementById('chart').getContext('2d');
                        const scatterChart = new Chart(ctx, {
                            type: 'scatter',
                            data: {
                                datasets: [{
                                    label: 'Scatter Dataset',
                                    data: buildData,
                                    pointBackgroundColor: 'rgba(223, 43, 43, 1)',
                                    backgroundColor: 'rgba(223, 43, 43, 1)',
                                    borderColor:  'rgba(223, 43, 43, 1)',
                                    pointBorderColor: 'rgba(223, 43, 43, 1)'
                                }]
                            },
                            options: {
                                scales: {
                                    yAxes: [{
                                        display: true,
                                        scaleLabel: {
                                            display: true,
                                            labelString: 'CPU'
                                        }
                                    }],
                                    xAxes: [{
                                        display: true,
                                        scaleLabel: {
                                            display: true,
                                            labelString: 'RAM'
                                        }
                                    }]
                                }
                            }
                        });


                    }
                });
            }
        });
    });
</script>

</body>
</html>
